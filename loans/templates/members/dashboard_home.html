{% extends "members/dashboard.html" %}

{% block content %}
<h1>Loan Management Dashboard</h1>

<div class="dashboard-cards">
    <!-- Summary Cards -->
    <div class="dashboard-card">
        <h3>Core Metrics</h3>
        <p>Total Borrowers: {{ total_borrowers }}</p>
        <p>Total Loans Outstanding: ${{ total_loans_outstanding }}</p>
        <p>Total Principal Disbursed: ${{ total_principal_disbursed }}</p>
    </div>

    <div class="dashboard-card">
        <h3>Financial Performance</h3>
        <p>Repayments Received: ${{ total_repayments_received }}</p>
        <p>Interest Earned: ${{ total_interest_earned }}</p>
        <p>Operating Expenses: ${{ total_operating_expenses }}</p>
        <p>Net Profit: ${{ net_profit }}</p>
    </div>

    <div class="dashboard-card">
        <h3>Loan Status Breakdown</h3>
        <p>Active Loans: {{ active_loans }}</p>
        <p>Pending Loans: {{ pending_loans }}</p>
        <p>Paid Off Loans: {{ paid_off_loans }}</p>
        <p>Defaulted Loans: {{ defaulted_loans }}</p>
    </div>

    <div class="dashboard-card">
        <h3>Recent Activity (Last 30 Days)</h3>
        <p>Applications: {{ recent_applications }}</p>
        <p>Disbursements: ${{ recent_disbursements }}</p>
        <p>Repayments: ${{ recent_repayments }}</p>
        <p>Repayment Rate: {{ repayment_rate }}%</p>
    </div>
</div>

<!-- Charts Section -->
<div class="charts-container">
    <div class="chart-wrapper">
        <h3>Loan Status Distribution</h3>
        <canvas id="loanStatusChart"></canvas>
    </div>

    <div class="chart-wrapper">
        <h3>Financial Metrics</h3>
        <canvas id="financialMetricsChart"></canvas>
    </div>

    <div class="chart-wrapper">
        <h3>Recent Activity</h3>
        <canvas id="recentActivityChart"></canvas>
    </div>
</div>

<!-- Chart.js Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Loan Status Pie Chart
    const loanStatusCtx = document.getElementById('loanStatusChart').getContext('2d');
    new Chart(loanStatusCtx, {
        type: 'pie',
        data: {
            labels: ['Active', 'Pending', 'Paid Off', 'Defaulted'],
            datasets: [{
                data: [{{ active_loans }}, {{ pending_loans }}, {{ paid_off_loans }}, {{ defaulted_loans }}],
                backgroundColor: ['#4CAF50', '#FFC107', '#2196F3', '#F44336'],
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom',
                }
            }
        }
    });

    // Financial Metrics Bar Chart
    const financialCtx = document.getElementById('financialMetricsChart').getContext('2d');
    new Chart(financialCtx, {
        type: 'bar',
        data: {
            labels: ['Repayments Received', 'Interest Earned', 'Operating Expenses', 'Net Profit'],
            datasets: [{
                label: 'Amount ($)',
                data: [{{ total_repayments_received }}, {{ total_interest_earned }}, {{ total_operating_expenses }}, {{ net_profit }}],
                backgroundColor: ['#4CAF50', '#FFC107', '#F44336', '#2196F3'],
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    // Recent Activity Bar Chart (using available data)
    const activityCtx = document.getElementById('recentActivityChart').getContext('2d');
    new Chart(activityCtx, {
        type: 'bar',
        data: {
            labels: ['Applications', 'Disbursements', 'Repayments'],
            datasets: [{
                label: 'Count/Value',
                data: [{{ recent_applications }}, {{ recent_disbursements }}, {{ recent_repayments }}],
                backgroundColor: ['#FF9800', '#9C27B0', '#00BCD4'],
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
});
</script>

<style>
.dashboard-cards {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 40px;
}

.dashboard-card {
    flex: 1 1 300px;
    background: #fff;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.charts-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
}

.chart-wrapper {
    flex: 1 1 400px;
    background: #fff;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.chart-wrapper h3 {
    text-align: center;
    margin-bottom: 20px;
}
</style>

{% endblock %}
