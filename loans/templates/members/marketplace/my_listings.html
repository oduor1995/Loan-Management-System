{% extends 'members/dashboard.html' %}
{% load static %}

{% block title %}My Business Listings - Marketplace{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-store"></i> My Business Listings
                    </h3>
                    <div class="card-tools">
                        <a href="{% url 'members:marketplace_create_listing' %}" class="btn btn-primary btn-sm">
                            <i class="fas fa-plus"></i> Create New Listing
                        </a>
                        <a href="{% url 'members:marketplace_home' %}" class="btn btn-secondary btn-sm ml-2">
                            <i class="fas fa-store"></i> Browse Marketplace
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    {% if listings %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Business</th>
                                    <th>Category</th>
                                    <th>Status</th>
                                    <th>Views</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for listing in listings %}
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            {% if listing.images.first %}
                                            <img src="{{ listing.images.first.image.url }}" class="rounded mr-3"
                                                 alt="{{ listing.title }}" style="width: 50px; height: 50px; object-fit: cover;">
                                            {% else %}
                                            <div class="bg-light rounded mr-3 d-flex align-items-center justify-content-center"
                                                 style="width: 50px; height: 50px;">
                                                <i class="fas fa-store text-muted"></i>
                                            </div>
                                            {% endif %}
                                            <div>
                                                <strong>{{ listing.title }}</strong>
                                                <br>
                                                <small class="text-muted">{{ listing.business_type }}</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        {% if listing.category %}
                                        <span class="badge badge-secondary">{{ listing.category.name }}</span>
                                        {% else %}
                                        <span class="text-muted">No category</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if listing.status == 'ACTIVE' %}
                                        <span class="badge badge-success">
                                            <i class="fas fa-check"></i> Active
                                        </span>
                                        {% elif listing.status == 'PENDING' %}
                                        <span class="badge badge-warning">
                                            <i class="fas fa-clock"></i> Pending Approval
                                        </span>
                                        {% elif listing.status == 'REJECTED' %}
                                        <span class="badge badge-danger">
                                            <i class="fas fa-times"></i> Rejected
                                        </span>
                                        {% else %}
                                        <span class="badge badge-secondary">
                                            <i class="fas fa-pause"></i> Inactive
                                        </span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="badge badge-info">
                                            <i class="fas fa-eye"></i> {{ listing.views_count }}
                                        </span>
                                    </td>
                                    <td>{{ listing.created_at|date:"M d, Y" }}</td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <a href="{% url 'members:marketplace_listing_detail' listing.pk %}"
                                               class="btn btn-outline-primary" title="View">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            {% if listing.status != 'PENDING' %}
                                            <a href="{% url 'members:marketplace_edit_listing' listing.pk %}"
                                               class="btn btn-outline-secondary" title="Edit">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            {% endif %}
                                            <a href="{% url 'members:marketplace_delete_listing' listing.pk %}"
                                               class="btn btn-outline-danger" title="Delete"
                                               onclick="return confirm('Are you sure you want to delete this listing?')">
                                                <i class="fas fa-trash"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-store fa-4x text-muted mb-3"></i>
                        <h4>No business listings yet</h4>
                        <p class="text-muted">Create your first business listing to get started!</p>
                        <a href="{% url 'members:marketplace_create_listing' %}" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Create Your First Listing
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Status Information Modal -->
<div class="modal fade" id="statusInfoModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Listing Status Information</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <h6><i class="fas fa-clock"></i> Pending Approval</h6>
                    <p>Your listing is being reviewed by church administrators. You will be notified once it's approved.</p>
                </div>
                <div class="alert alert-success">
                    <h6><i class="fas fa-check"></i> Active</h6>
                    <p>Your listing is live and visible to other church members in the marketplace.</p>
                </div>
                <div class="alert alert-danger">
                    <h6><i class="fas fa-times"></i> Rejected</h6>
                    <p>Your listing was not approved. Please contact your church administrator for details.</p>
                </div>
                <div class="alert alert-secondary">
                    <h6><i class="fas fa-pause"></i> Inactive</h6>
                    <p>Your listing is currently hidden from the marketplace.</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}